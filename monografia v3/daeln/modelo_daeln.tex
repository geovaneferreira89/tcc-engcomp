%% Exemplo de utilizacao do estilo de formatacao abnt-UTFPR.cls para LaTeX (v1.2)
%% Autores: Hugo Vieira Neto (hvieir@utfpr.edu.br)
%%          Diogo Rosa Kuiaski (diogo.kuiaski@gmail.com)

\documentclass{abnt-UTFPR} % estilo de documento abnTeX
\usepackage[alf,abnt-emphasize=bf,bibjustif,recuo=0cm]{abntcite} % estilo de bibliografia abnTeX
\usepackage[brazil]{babel} % pacote portugues brasileiro
\usepackage[latin1]{inputenc}
\usepackage{amsmath,amsfonts,amssymb} % pacote matematico
\usepackage{graphicx} % pacote grafico
\usepackage{fixltx2e}
\usepackage{multirow} %pacote tabela
\usepackage[section,subsection,subsubsection]{extraplaceins} %pacote pra figura não sair do lugar!

%tabelas ajustáveis
\usepackage{tabulary}
%fixar tabelas no mesmo lugar
\usepackage{float}
%\restylefloat{table}


% ---------- Preambulo ----------
\instituicao{Universidade Tecnológica Federal do Paraná} % nome da instituicao
\departamento{Departamento Acadêmico de Eletrônica/Informática} % nome do departamento
\programa{Curso Superior de Engenharia de Computação} % nome do curso

\documento{Trabalho de Conclusão de Curso} % tipo de documento
\titulacao{Engenheiro} % [Técnico], [Tecn\'ologo] ou [Engenheiro]

\titulo{Avaliação de Redes Neurais no Reconhecimento de Complexo QRS em Sinais de Eletrocardiografia} % titulo do trabalho em portugues
\title{Neural Networks Evaluation in QRS Complex Classification in Electrocardiographical Signals } % titulo do trabalho em ingles

\autor{Georgea Danielewicz \protect\\ Geovane Vinicius Ferreira} % autor do trabalho
\cita{DANIELEWICZ, Georgea \protect e FERREIRA, Geovane Vinicius} % sobrenome (maiusculas), nome do autor do trabalho

\palavraschave{eletrocardiografia, complexo QRS, análise de sinal, reconhecimento de padrões} % palavras-chave do trabalho
\keywords{electrocardiography, QRS-complex, signal analysis, pattern recognition} % palavras-chave do trabalho em ingles


\comentario{\UTFPRdocumentodata\ apresentado ao \UTFPRdepartamentodata\ como requisito parcial para obtenção do grau de \UTFPRtitulacaodata\ no \UTFPRprogramadata\ da \ABNTinstituicaodata.}

\orientador{Professor Miguel Sovierzoski} % nome do orientador do trabalho
%\orientador[Orientadora:]{Nome da Orientadora} % <- no caso de orientadora, usar esta sintaxe
%\coorientador{Nome do Co-orientador} % nome do co-orientador do trabalho, caso exista
%\coorientador[Co-orientadora:]{Nome da Co-orientadora} % <- no caso de co-orientadora, usar esta sintaxe

\local{Curitiba} % cidade
\data{2013} % ano


%---------- Inicio do Documento ----------
\begin{document}

\capa % geracao automatica da capa
\folhaderosto % geracao automatica da folha de rosto
%\termodeaprovacao % <- ainda a ser implementado corretamente

% dedicatória (opcional)
%\begin{dedicatoria}
%Texto da dedicatória.
%\end{dedicatoria}

% agradecimentos (opcional)
\begin{agradecimentos}
Nossos sinceros agradecimentos ao Professor Miguel Antonio Sovierzoski, por ter orientado este trabalho com grande dedicação, estando sempre presente. 

Agradecemos de coração a todos os nossos familiares, pois sem eles esta realização jamais teria sido possível. E também a nossos amigos e colegas, pelos incentivos e pelo apoio. 
\end{agradecimentos}

% epigrafe (opcional)
% citação, seguida de indicação de autoria e ano, relacionada com a matéria tratada no corpo do trabalho
\begin{epigrafe}
"The human heart is not unchanging (nay, changes almost out of recognition in the twinkling of an eye) \dots" 
\begin{flushright}
    (C.S. Lewis)
\end{flushright}

"O coração humano não é imutável (ou melhor, muda quase que irreconhecivelmente no piscar de um olho) \dots" 
\begin{flushright}
    (C.S. Lewis)
\end{flushright}

\end{epigrafe}

%resumo
\begin{resumo}

Os exames eletrocardiográficos são considerados uma ferramenta bastante importante no diagnóstico de problemas cardíacos. Para avaliar adequadamente a situação de um coração, é necessário detectar corretamente o complexo QRS durante a análise do sinal de Eletrocardiografia (ECG), muitas vezes com artefatos. Este fato dificulta a rotina dos profissionais que analisam este tipo de exame. Em virtude disto, são necessárias ferramentas que busquem otimizar esta leitura e busca pelo padrão QRS. O objetivo deste projeto é desenvolver um sistema computacional para reconhecimento do complexo QRS em sinais de\sigla{ECG}{Eletrocardiografia}. A metodologia adotada foi composta pelas etapas de projeto, desenvolvimento e testes. As etapas de desenvolvimento e testes utilizaram uma base de dados de exames de ECG de domínio público. A etapa de testes foi realizada pela própria equipe, por meio de um módulo do sistema específico para este fim. O sistema desenvolvido é composto por cinco módulos: visualização, marcação de eventos, extração de características, reconhecimento de padrões e avaliação dos resultados. O módulo de extração de características aplica a função de correlação entre o padrão escolhido e o sinal de ECG, produzindo um novo sinal que funciona como entrada para o módulo de reconhecimento de padrões. Os eventos detectados por este módulo de reconhecimento são exibidos graficamente na tela. Por fim, o módulo de avaliação compara os resultados obtidos e os esperados, e os classifica como verdadeiro positivo, verdadeiro negativo, falso positivo ou falso negativo. Com base nesta avaliação, foram realizadas as análises de sensibilidade e especificidade, permitindo a representação da Curva ROC do sistema classificador. Os resultados do projeto consistem, portanto, no próprio sistema e sua aplicação prática.

\end{resumo}

%abstract
\begin{abstract}

Electrocardiographic recordings are considered  to be a highly important  tool in the diagnosis of cardiac disease. So as to make a proper evaluation of the heart condition, one must accurately detect the QRS-complex during the analysis of the electrocardiographic (ECG) signal, often corrupted by noise. Such fact hinders the routines of the professionals who analyze this type of medical recording. In consequence, tools that improve the QRS-complex detection are required. The aim of this project is the development of a computing system for QRS-complex identification in ECG signals. The methodology employed in this project comprises the stages of project, development and tests. The development and tests stages have used an ECG database available in the public domain. The tests stage was performed by the team responsible for this project by using a tool built in the system for this specific purpose. The system is composed of the following modules: ECG signal visualizing, event marking, characteristic extraction, pattern classification and results evaluation. The characteristic extraction module correlates a pattern and the ECG signal, producing a new signal, which works as input for the pattern classification module. The events detected by this pattern classification module are graphically exhibited on the computer screen. Finally, the evaluation module compares the results obtained from the system with the annotations from the database, and classify them as true positive, false positive, true negative or false negative. Based on this evaluation, both sensibility and specificity analysis were calculated, which allows the plot of a ROC graph. The achievements of this project, therefore, consist of the system itself and its practical usage. 

\end{abstract}

% listas (opcionais, mas recomenda-se a partir de 5 elementos)
\listadefiguras % geracao automatica da lista de figuras
\listadetabelas % geracao automatica da lista de tabelas
\listadesiglas % geracao automatica da lista de siglas
%\listadesimbolos % geracao automatica da lista de simbolos

% sumario
\sumario % geracao automatica do sumario


%---------- Inicio do Texto ----------
% recomenda-se a escrita de cada capitulo em um arquivo texto separado (exemplo: intro.tex, fund.tex, exper.tex, concl.tex, etc.) e a posterior inclusao dos mesmos no mestre do documento utilizando o comando \input{}, da seguinte forma:
\input{intro.tex} 
\input{fund.tex}
%\input{exper.tex}


%Considerações: 
%1. não ultrapassar 100 páginas
%2. introdução 5%, considerações finais 5%, fundamentação, materiais e métodos e resultados obtidos 90%
%3. 2 páginas, 1 páginas, 					15,16 páginas, 	20 páginas ,		 5 páginas
% -------------------------------------------
\chapter{Materiais e Métodos} %ou Materiais e Métodos 
\label{sec:Materiais}

Este capítulo aborda os recursos e metodologias utilizadas no desenvolvimento deste trabalho. O capítulo foi dividido em seções: \ref{sec:BD} Base de Dados de Sinais de Eletrocardiografia, \ref{sec:EDF} \textit{European Data Format}, \ref{sec:Bib} Bibliotecas Utilizadas, \ref{sec:MOD} Sistema, \ref{sec:UML} Modelagem \sigla{UML}{\textit{Unified Modeling Language}}, \ref{sec:Met-Testes} Metodologia de Testes e por fim, a seção \ref{sec:Cons-Des} Considerações.

\section{Base de Sinais de Eletrocardiografia}
\label{sec:BD}

De acordo com informações disponibilizadas pela Comissão Nacional de Ética em Pesquisa ~\cite{CONEP}, ``as pesquisas envolvendo apenas dados de domínio público que não identifiquem os participantes da pesquisa, ou apenas revisão bibliográfica, sem envolvimento de seres humanos, não necessitam aprovação por parte do Sistema CEP~--\sigla{CONEP}{Comissão Nacional de Ética em Pesquisa}.'' Por esta razão, a equipe optou por utilizar a base de dados pública \textit{MIT-BIH Arrhythmia Database}. 

A \textit{MIT-BIH Arrhythmia Database} foi desenvolvida pelo Beth Israel Hospital de Boston em parceria com o \sigla{MIT}{\textit{Massachusetts Institute of Technology}} durante uma pesquisa sobre arritmia e temas correlatos. Tem sido utilizada como um conjunto de dados padrão para testes e avaliação para sistemas detectores de arritmias e pesquisa em dinâmica cardíaca ~\cite{MOODY1990}.

Os dados correspondem à 48 gravações de sinais de ECG com duração de meia hora cada uma. São apresentados dois sinais, \textit {modified limb lead II} (MLII) e \textit{lead} V1 (podendo ser ocasionalmente V2, V5 ou V4), ambos obtidos com os eletrodos colocados no peito. Esta é a configuração padrão utilizada pelo \textit{BIH Arrhythmia Laboratory}. Pode-se observar maior proeminência dos complexos QRS no sinal superior ~\cite{PhysioNet}. A figura ~\ref{105} mostra parte da gravação do exame 105.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.7\textwidth]{./figs/105.png} % <- formatos PNG, JPG e PDF
	\caption[Época do arquivo 105 da base de ECG da base de dados \textit{MIT-BIH Arrhythmia Database}]{Época do arquivo 105 da base de ECG da base de dados \textit{MIT-BIH Arrhythmia Database}}
	\fonte{Autoria própria}
	\label{105}
\end{figure}

Os exames foram realizados com 47 pacientes acompanhados pelo \textit{BIH Arrhythmia Laboratory} entre os anos de 1975 e 1979. Vinte e três gravações foram selecionadas aleatoriamente de um conjunto de 4000 exames ambulatoriais de ECG com duração de 24 horas coletadas de pacientes internos (cerca de 60\%) e pacientes ambulatoriais (cerca de 40\%) do Boston's Beth Israel Hospital. Os outros 25 exames foram selecionados do mesmo conjunto para incluir arritmias clinicamente incomuns ~\cite{MOODY1990}.

Uma equipe com dois cardiologistas realizou anotações dos batimentos em cada uma das gravações, resultando em aproximadamente 110 mil marcações de eventos, entre eles o complexo QRS. Estas foram incluídas na base de dados. A base completa tem sido disponibilizada gratuitamente desde 2005 ~\cite{MOODY1990}.

Para a etapa de testes deste projeto, foi selecionado apenas o arquivo 105 por apresentar maior dificuldade na detecção do complexo QRS ~\cite{SARAIVA2012}.

 
\section{Padrão \textit{European Data Format}}
\label{sec:EDF}

A existência de diferentes fabricantes de equipamentos para aquisição de sinais biomédicos implica em diferentes formatos de arquivo para salvar estes dados. Para solucionar este problema, foi elaborado o \textit{European data format} (EDF), um formato padrão para armazenamento de dados polissonográficos e eletroencefalográficos amplamente aceito. O \sigla{EDF}{\textit{European Data Format}} é o único formato digital que se tornou aceito tanto comercialmente nos equipamentos disponíveis como em pesquisas cientificas \cite{Kemp20031755}.

Um arquivo EDF padrão consiste em um cabeçalho seguido dos dados amostrados. O cabeçalho identifica o paciente e especifica características técnicas do sinal gravado. Os dados apresentam épocas consecutivas, com duração fixa, a partir do sinal gravado \cite{Kemp20031755}.

\textit{Physiobank} \textit{Automated Teller Machine} (ATM) é uma ferramenta \textit{open--source} que permite explorar as bases de dados disponibilzadas pelo \textit{Physiobank} por meio do navegador de \textit{internet}. Esta \textit{toolbox} oferece opções para importar anotações das formas de onda e histogramas, converter sinais em formato padrão do \textit{Physionet} (\textit{WaveForm DataBase} -- \sigla{WFDB}{\textit{WaveForm DataBase}}) para texto, CSV, EDF, ou .mat files (para utilização nos programas \textit{Matlab} ou \textit{Octave}), entre outras funcionalidades \cite{PhysioNet}.

A figura ~\ref{ATM} mostra a tela de opções da ferramenta \textit{Physiobank} \sigla{ATM}{\textit{Automated Teller Machine}}.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=1\textwidth]{./figs/ATM.png} % <- formatos PNG, JPG e PDF
	\caption[Tela de opções do \textit{Physiobank} ATM]{Tela de opções do \textit{Physiobank} ATM}
	\fonte{Autoria própria}
	\label{ATM}
\end{figure}

Esta ferramenta foi utilizada para obtenção dos arquivos de sinal em formado EDF e anotações em arquivo de texto.

\section{Bibliotecas Utilizadas}
\label{sec:Bib}
O projeto utilizou as bibliotecas \textit{NeuroLoopGain} e \textit{BrainNet Library} para trabalhar com arquivos em formato EDF e redes neurais artificiais respectivamente.

\subsection{Biblioteca \textit{NeuroLoopGain}}

A biblioteca \textit{NeuroLoopGain} \cite{Neuroloop} foi implementada para análise de arquivos em formato EDF.
O texto da licença Apache 2.0 \cite{Apache} mostra que seu código é aplicável a distribuição pretendida do software: ``[ \dots] concede licença perpétua, mundial, não exclusiva, gratuita, isenta de \textit{royalties} e irrevogável para reproduzir, preparar Obras Derivadas, de exibição pública, execução pública, sublicenciamento e distribuição do Trabalho e tais Obras Derivadas, na forma de Código Fonte ou Objeto. ''

Além disso, o texto da licença também atesta que: ``[ \dots] concede licença perpétua, mundial, não-exclusiva, gratuita, isenta de \textit{royalties} e irrevogável [\dots] de licença de patente para fazer, mandar fazer, usar, oferecer para venda, vender, importar e transferir o trabalho. ''

\subsection{Biblioteca \textit{BrainNet Library}}

A biblioteca \textit{BrainNet Library}, em sua maior parte desenvolvida na plataforma .NET seguindo os preceitos do paradigma de orientação à objetos, permite criar, treinar e executar redes neurais. Uma parte da biblioteca, chamada Neural XML, foi implementada em linguagem de programação \sigla{XML}{\textit{eXtensible Markup Language}} \cite{NN}.  Está sujeita aos termos da licença \textit{The Code Project Open License} (\sigla{CPOL}{\textit{The Code Project Open License}}) 1.02. De maneira geral, os termos da licença \cite{Code} atestam os seguintes pontos:

\begin{itemize}
	\item Código fonte e arquivos executáveis podem ser utilizados em aplicações comerciais;
	\item Código fonte e arquivos executáveis podem ser redistribuídos; 
	\item Código fonte pode ser modificado para criação de obras derivativas.
\end{itemize}

A figura \ref{UML1} apresenta o diagrama UML da biblioteca.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=1\textwidth]{./figs/UML1.png} % <- formatos PNG, JPG e PDF
	\caption[Diagrama UML da Biblioteca \textit{BrainNet Library}]{Diagrama UML da Biblioteca \textit{BrainNet Library}}
	\fonte{\cite{NN}}
	\label{UML1}
\end{figure}

As principais interfaces disponibilizadas pela biblioteca \textit{BrainNet Library} estão resumidas na tabela \ref{Interfaces}.

\begin{table}[!htb]
	\centering
	\caption[Principais interfaces da \textit{BrainNet Library}]{Principais interfaces da \textit{BrainNet Library}}
	\label{Interfaces}
	\begin{tabular}{ll}
	\hline
	\textbf{INetworkFactory} & Interface que define a estrutura da rede     \\ \hline
	\textbf{INeuron}         & Interface que define o neurônio              \\ \hline
	\textbf{INeuronStrategy} & Interface que define estratégias do neurônio \\ \hline
	\textbf{INeuralNetwork}  & Interface que define a rede neural           \\ \hline 
	\end{tabular}
	\fonte{\cite{NN}}
\end{table}

As principais classes disponibilizadas pela biblioteca \textit{BrainNet Library} estão resumidas na tabela \ref{Classses}.

\begin{table}[!htb]
	\centering
	\caption[Principais classes da \textit{BrainNet Library}]{Principais classes da \textit{BrainNet Library}}
	\label{Classses}
	\begin{tabular}{ll}
	\hline
	\textbf{BackPropNeuronStrategy}  & Estratégia \textit{backpropagation}\\ \hline
	\textbf{NetworkHelper}           & Inicializa e treina a rede \\ \hline
	\textbf{NeuralNetwork}           & Rede neural genérica \\ \hline
	\textbf{NeuralNetworkCollection} & Coleção do tipo NeuralNetwrok \\ \hline
	\textbf{Neuron}                  & Implementação de INeuron \\ \hline
	\textbf{NeuronCollection}        & Coleção do tipo Neuron \\ \hline
	\textbf{NeuronConnections}       & Registro das conexões entre neurônios e pesos sinápticos \\ \hline
	\end{tabular}
	\fonte{\cite{NN}}
\end{table}

\section{Sistema}
\label{sec:MOD} 
Esta seção pretende fornecer um entendimento amplo do sistema desenvolvido a partir da subseção \ref{Vgeral} Visão Geral do Sistema, e também uma visão detalhada por meio das subseções: \ref{Mod1} Módulo de Visualização do Sinal, \ref{Mod2} Módulo de Marcação de Eventos, \ref{Mod3} Módulo de Extração de Características, \ref{Mod4} Módulos de Reconhecimento de Padrões, \ref{RecKHN} Módulo de Reconhecimento de Padrões com Mapa de Kohonen, \ref{RecMLP} Módulo de Reconhecimento de Padrões com Rede Perceptron Multicamadas e \ref{Mod5} Módulo de Avaliação de Resultados.

\subsection{Visão Geral do Sistema}
\label{Vgeral} 

O sistema desenvolvido neste trabalho oferece duas técnicas diferentes para o reconhecimento de padrões: utilizando o mapa de Kohonen e utilizando a rede Perceptron multicamadas. Esta subseção apresenta uma visão geral do funcionamento das redes.

A figura ~\ref{fluxo1} mostra o processo com a técnica de mapa de Kohonen. Primeiramente, o arquivo com o sinal de ECG é carregado na memória e exibido na tela (Visualização do sinal), em seguida, é feito o reconhecimento de padrões (Reconhecimento de Padrões), e os resultados são exibidos na tela . Um conjunto de marcações pertencente a base de dados (Marcações da base de dados) é utilizado como parâmetro de comparação com os resultados obtidos pelo sistema (Avaliação dos Resultados).

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.4\textwidth]{./figs/fluxogramaRaw.png} % <- formatos PNG, JPG e PDF
	\caption[Fluxograma do treinamento não supervisionado do mapa de Kohonen]{Fluxograma do treinamento não supervisionado do mapa de Kohonen}
	\fonte{Autoria própria}
	\label{fluxo1}
\end{figure}

Com a utilização da rede Perceptron multicamadas, o treinamento pode ser realizado de suas maneiras. A primeira, e mais simples delas, utiliza diretamente o sinal de Eletrocardiografia (ECG). A figura ~\ref{fluxoRNA1} mostra todo este processo.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.6\textwidth]{./figs/visaogeral1.png} % <- formatos PNG, JPG e PDF
	\caption[Fluxograma do treinamento supervisionado da rede Perceptron Multicamadas]{Fluxograma do treinamento supervisionado da rede Perceptron Multicamadas}
	\fonte{Autoria própria}
	\label{fluxoRNA1}
\end{figure}

Assim como no mapa de Kohonen, o arquivo com o sinal de ECG é carregado na memória e exibido na tela (Visualização do sinal), em seguida, são marcados eventos no sinal (Marcação de eventos). Com o conjunto de dados gerada nesta etapa, a rede neural é treinada (Treinamento da rede neural). É então feito o reconhecimento de padrões (Reconhecimento de Padrões) no sinal de ECG original, e os resultados são exibidos na tela. Um conjunto de marcações pertencente a base de dados (Marcações da base de dados) é utilizado como parâmetro de comparação com os resultados obtidos pelo sistema (Avaliação dos Resultados). 

A segunda maneira de treinar a rede neural é mais complexa, e pode ser observada no fluxograma da figura ~\ref{fluxoRNA2}. 

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.6\textwidth]{./figs/visaogeral2.png} % <- formatos PNG, JPG e PDF
	\caption[Fluxograma da extração de características via operação de correlação e do treinamento supervisionado da rede Perceptron Multicamadas]{Fluxograma da extração de características via operação de correlação e do treinamento supervisionado da rede Perceptron Multicamadas}
	\fonte{Autoria própria}
	\label{fluxoRNA2}
\end{figure}
 

Depois que o arquivo com sinal de ECG é carregado e exibido na tela (Visualização do sinal), são feitas marcações diretamente no sinal de ECG (Marcar eventos). Estas marcações do complexo QRS (Marcações direto no sinal) passam por um processo (Extração de características) em conjunto com o sinal original (Sinal de ECG). Este processo é detalhado nas subseção \ref{Mod3} Módulo de Extração de Características. São feitas novas marcações (Nova marcação de ventos) gerando um novo conjunto de dados (Maracações após correlação) A rede neural é treinada com estes dados (Treinamento da rede neural artificial). O sinal resultante (Sinal resultante) passa pelo reconhecimento de padrões (Reconhecimento de Padrões), e exibe na tela onde são detectadas ocorrências do complexo QRS. Por fim é realizada a etapa de avaliação (Avaliação dos Resultados), que compara os resultados obtidos com os resultados esperados proveniente das marcações da base de dados original (Marcações da base de dados). 

\subsection{Módulo de Visualização do Sinal}
\label{Mod1} 

O primeiro módulo do sistema a ser descrito é o módulo de visualização do sinal. Na figura \ref{tela1} pode ser observada a tela em que o usuário seleciona quais canais (ou derivações) do sinal deseja visualizar. No caso, as derivações do sinal são {\textit{modified limb lead} II} (MLII) e \textit{lead} V1 .

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.6\textwidth]{./figs/tela0.png} % <- formatos PNG, JPG e PDF
	\caption[Tela de seleção de canais do sistema]{Tela de seleção de canais do sistema}
	\fonte{Autoria Própria}
	\label{tela1}
\end{figure}

Sobre a tela de seleção do sistema, é possível fazer a montagem dos sinais selecionados por meio do botão Montagem. Basicamente, são associados em pares, o primeiro e o segundo canais, terceiro e o quarto e assim por diante. Então é realizada a subtração. Esta funcionalidade deve ser configurada pelo médico, é muito utilizada para exibir na tela determinadas configurações de sinais de Eletroencefalografia (EEG). No entanto, esta funcionalidade não é utilizada na análise de sinais de Eletrocardiografia (ECG).

A figura \ref{telaV} mostra a impressão do sinal na tela do sistema. Além dos sinais, a tela também apresenta opções para alterar a frequência e amplitude do sinal e opções para que o sinal possa ser visualizado em janelas de 5 ou 10 segundos.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=1\textwidth]{./figs/tela2.png} % <- formatos PNG, JPG e PDF
	\caption[Tela de visualização do sinal de ECG no sistema]{Tela de visualização do sinal de ECG no sistema}
	\fonte{Autoria Própria}
	\label{telaV}
\end{figure}

\subsection{Módulo de Marcação de Eventos}
\label{Mod2} 
Uma vez que a tela do sistema exibe o sinal de Eletrocardiografia (ECG), o usuário pode realizar as marcações de eventos. Ao selecionar o botão evidenciado pela flecha azul na figura \ref{tela3}, o usuário tem acesso a um menu de marcações. 

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.5\textwidth]{./figs/telab.png} % <- formatos PNG, JPG e PDF
	\caption[Opção de marcar eventos no sinal de ECG]{Opção de marcar eventos no sinal de ECG}
	\fonte{Autoria Própria}
	\label{tela3}
\end{figure}

O usuário pode selecionar uma cor disponível no menu do lado esquerdo, e em seguida marcar fragmentos no sinal, determinando assim o início e o fim do evento. Estas marcações são salvas em disco utilizando arquivos de texto, podendo ser recuperadas em algum uso futuro. A figura \ref{tela2} mostra a tela com opção de marcação de eventos. Na figura, a cor selecionada foi o verde (correspondente ao complexo QRS), exibindo duas marcações deste evento no sinal. Também é possível adicionar comentários, através do Menu Ferramentas, Habilitar Comentários. Assim, quando um evento é marcado, automaticamente é exibida uma tela para o usuário digitar o comentário desejado, e este também é adicionado na tela principal do sinal, dentro da área marcada.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=1\textwidth]{./figs/tela3.png} % <- formatos PNG, JPG e PDF
	\caption[Marcações de eventos no sinal de ECG]{Marcações de eventos no sinal de ECG}
	\fonte{Autoria Própria}
	\label{tela2}
\end{figure}


Após a realização de algumas marcações, o usuário pode editá-las por meio do Editor de marcações, mostrado na figura \ref{tela5}. Para acessá-lo, basta clicar em Menu Ferramentas, e em seguida, em Editor de Eventos. Este editor permite que o usuário navegue pelos tipos de padrão e visualize as marcações já salvas. O usuário tem a opção de editar os pontos de início, fim e referência do sinal, e também pode excluir a marcação.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.7\textwidth]{./figs/tela5.png} % <- formatos PNG, JPG e PDF
	\caption[Editor de marcação de evento]{Editor de marcação de evento}
	\fonte{Autoria Própria}
	\label{tela5}
\end{figure}

\subsection{Módulo de Extração de Características através da Correlação}
\label{Mod3} 
O módulo de extração de características produz um novo sinal, que pode ser utilizado como entrada do módulo de reconhecimento de padrões. A função correlação pode ser aplicada sucessivas vezes em um evento salvo (do tipo que se quer buscar, no caso o complexo QRS) e o sinal de Eletrocardiografia (ECG). O resultado pode ser observado na figura \ref{telaEC}, o primeiro sinal corresponde ao sinal original de ECG, e o segundo foi produzido pela extração de características. O acesso desta tela pode ser obtido ao selecionar Menu Ferramentas e Técnicas de Reconhecimento.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=1\textwidth]{./figs/corr4.png} % <- formatos PNG, JPG e PDF
	\caption[Tela da extração de características via correlação]{Tela da extração de características via correlação}
	\fonte{Autoria Própria}
	\label{telaEC}
\end{figure}

A extração de características é o processo pelo qual o sinal de Eletrocardiografia (ECG) pode ser submetido antes do processo de reconhecimento de padrões. A função correlação, descrita na seção \ref{sec:Correl} do capítulo de Fundamentação Teórica \ref{sec:Fund}, é aplicada sucessivas vezes (no caso apenas duas) em uma marcação arbitrária que represente bem o complexo QRS e no sinal de ECG produzindo um novo sinal como mostrado na figura \ref{corr5}.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.9\textwidth]{./figs/corr5.png} % <- formatos PNG, JPG e PDF
	\caption[Função correlação no sistema]{Função correlação no sistema}
	\fonte{Autoria Própria}
	\label{corr5}
\end{figure}

Como se pode perceber, os picos do sinal resultante correspondem aos instantes em que ocorrem o complexo QRS. Este novo sinal pode ser utilizado como entrada para o módulo de reconhecimento de padrões, a ser visto com mais detalhes na próxima seção.

\subsection{Módulos de Reconhecimento de Padrões}
\label{Mod4} 

O módulo de reconhecimento de padrões oferece duas técnicas distintas: mapa de Kohonen e rede neural artificial Perceptron multicamadas. A rede neural Perceptron multicamadas pode ser treinada com dois tipos de dados diferentes: eventos marcados diretamente no sinal de Eletrocardiografia (ECG), ou eventos marcados no sinal resultante da extração de características (aplicação da correlação). A próxima subseção descreve o processo com a utilização do mapa de Kohonen. A subseção seguinte descreve o reconhecimento de padrões utilizando a rede Perceptron multicamadas.

\subsection{Módulo de Reconhecimento de Padrões com Mapa de Kohonen}
\label{RecKHN}

Como foi explicado no capítulo de Fundamentação Teórica, o Mapa de Kohonen agrupa nós com características similares em localizações próximas. No exemplo da clusterização de cores, os nós de cor azul foram agrupados em uma determinada localização. Da mesma forma, o Mapa de Kohonen agrupa fragmentos de sinais com características similares.

O Mapa de Kohonen foi utilizado com o objetivo de identificar ocorrências do complexo QRS em meio ao sinal de Eletrocardiografia (ECG). Considerando que o sinal de ECG utilizado pode ser dividido em fragmentos com diferentes características, alguns poderão apresentar o complexo QRS inteiro ou partes dele, outros poderão apresentar outras formas de onda como a onda P, T ou U, arritmias cardíacas ou apenas ruído. 

O mapa é inicializado com fragmentos, ou janelas, obtidos do sinal. Inicialmente, foram realizados testes percorrendo o sinal todo e captando fragmentos deslocando o sinal ponto por ponto. Contudo, isso gerava fragmentos redundantes e aumentava o tempo de duração da etapa de reconhecimento de padrões. Em vista disso, foi decidido deslocar o sinal de cinco em cinco amostras para obtenção de cada janela. Outro aspecto relevante é que para particionar o sinal de ECG sem extração de características, são usadas 50 amostras. No particionamento do sinal de ECG após a extração de características é necessário utilizar 200 amostras.

A figura \ref{classi1} mostra um exemplo simplificado de como seria uma mapa inicializado. As estrelas azuis representam nós onde existem fragmentos com o complexo QRS, e as bolas vermelhas representam fragmentos de sinal que não apresentam esta forma de onda.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.5\textwidth]{./figs/classi0.png} % <- formatos PNG, JPG e PDF
	\caption[Exemplo de mapa de Kohonen inicializado aleatoriamente com o sinal de ECG]{Exemplo de mapa de Kohonen inicializado aleatoriamente com o sinal de ECG}
	\fonte{Autoria Própria}
	\label{classi1}
\end{figure}

Após a aplicação do treinamento não supervisionado, o mapa deverá se assemelhar ao mapa da figura \ref{classi2}. Neste exemplo, os sinais com características do complexo QRS formam um grupo, e os sinais com quaisquer outras características formam o outro grupo.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.5\textwidth]{./figs/classi1b.png} % <- formatos PNG, JPG e PDF
	\caption[Exemplo de mapa de Kohonen após o treinamento não supervisionado]{Exemplo de mapa de Kohonen após o treinamento não supervisionado}
	\fonte{Autoria Própria}
	\label{classi2}
\end{figure}

O tamanho do Mapa é variável, contudo, manteve-se um tamanho padrão de 10 por 10 nós para os testes. Nós contendo fragmentos do sinal com características do complexo QRS tenderam a se localizar nas regiões em que as coordenadas \textit{x} e \textit{y} se aproximam de 0. Para separar a região onde se concentra o complexo QRS do restante do mapa, determinam-se valores de corte do \textit{x} e \textit{y}. Por exemplo, os nós com os valores de \textit{x} e \textit{y} entre 0 e 2 representam o grupo de padrões que se deseja buscar.

O algoritmo do Mapa de Kohonen segue a lógica detalhada no artigo de \cite{Guthi}.

Para acessar a opção de reconhecimento de padrões com mapa de Kohonen, basta selecionar na tela de Técnicas de Reconhecimento a opção Técnicas e em seguida Kohonen. Será exibida uma tela da figura \ref{rec0}, que permite configurar o mapa, tais como tamanho, uso da correlação (extração de características) e tamanho das amostras, por padrão definido como 50.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.5\textwidth]{./figs/rec0.png} % <- formatos PNG, JPG e PDF
	\caption[Tela de configuração do mapa de Kohonen]{Tela de configuração do mapa de Kohonen}
	\fonte{Autoria Própria}
	\label{rec0}
\end{figure}


A figura \ref{rec1} mostra a tela em que são exibidos os resultados após a execução da etapa de reconhecimento de padrões. O sinal em laranja apresenta amplitude elevada nas detecções do padrão.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=1\textwidth]{./figs/rec0b.png} % <- formatos PNG, JPG e PDF
	\caption[Tela de resultados do mapa de Kohonen]{Tela de resultados do mapa de Kohonen}
	\fonte{Autoria Própria}
	\label{rec1}
\end{figure}

\subsection{Módulo de Reconhecimento de Padrões com Rede Perceptron Multicamadas} 
\label{RecMLP}

A rede neural artificial foi implementada com três camadas. A camada de entrada, uma camada escondida e a camada de saída. Devido ao fato de o sinal apresentar 250 amostras por segundo, e o tamanho médio de um complexo QRS no sinal ser de 50 amostras, na camada de entrada o número de neurônios é 50. No entanto, este valor pode ser alterado, conforme as necessidades do usuário.

Também foi utilizado o ajuste de referência do editor de eventos. Para que as janelas de sinal apresentadas corretamente à rede, e não deslocadas, evitando erros no treinamento.
 
Na segunda camada da rede, foi utilizada a raiz do número de neurônios da camada de entrada. Ou seja, o número inteiro superior a raiz de 50. Este valor é alterado conforme se altera o tamanho da camada de entrada. A topologia da rede, portanto, pode ser representada como 50:8:1.

Finalmente, a última camada têm somente uma saída, que varia de 0 a 1. A equação  ~(\ref{eq:sigmo}) define a função de \textit{threshold} utilizada.

\begin{equation}
\varphi (z) = \frac{1}{ 1 + e^{-z\alpha }}
\label{eq:sigmo}
\end{equation}

Outro fator que influenciou a análise, foram os pesos aleatórios iniciais, que variam entre -0,2 e +0,2. Estas são portanto, as configurações da rede neural multicamadas deste projeto.

A mesma rede Perceptron multicamadas foi treinada com dois conjuntos de dados distintos.O primeiro conjunto de dados foi formado por eventos marcados diretamente no sinal. Os testes para a rede treinada com este conjunto de dados são feitos com sinal de ECG original.

O segundo conjunto de dados utiliza eventos marcados no sinal resultante da extração de características por correlação. Obviamente, a rede treinada com este conjunto de dados, também realiza o reconhecimento de padrões no sinal resultante da extração de características. Mais informações sobre estes conjuntos de dados se encontram na subseção \ref{sec:geradados} Geração de Dados de Treinamento.

Na figura \ref{redemlpresulta} pode ser visualizada a tela de resultados após a conclusão do treinamento da rede e do processo de reconhecimento de padrões.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=1\textwidth]{./figs/3.png} % <- formatos PNG, JPG e PDF
	\caption[Tela de resultados da rede multicamadas]{Tela de resultados da rede multicamadas}
	\fonte{Autoria Própria}
	\label{redemlpresulta}
\end{figure}

Na tela de resultados das técnicas de reconhecimento, após a utilização da rede Perceptron multicamadas ou mapa de Kohonen, caso o usuário feche a tela, o aplicativo pergunta se deseja salvar os resultados. Em caso afirmativo, estes dados são salvos em um arquivo no mesmo diretório e com mesmo nome do arquivo do sinal (.edf), porém com uma extensão, e ficam disponíveis para uso futuro. Caso o usuário deseje visualizar os dados salvos na tela principal é necessário em Ferramentas e Resultados e automaticamente os resultados são carregados. Da mesma forma quando o arquivo do sinal é aberto o aplicativo verifica se já existe algum arquivo com resultados já salvo, e verifica se o usuário deseja carregá-los na tela.

\subsection{Módulo de Avaliação de Desempenho das Redes Neurais}
\label{Mod5} 
Com a conclusão da etapa de reconhecimento de padrões, podem ser gerados dados estatísticos para avaliar o desempenho do sistema. Os resultados obtidos são comparados às marcações provenientes da base de dados, que indicam existência do complexo QRS no sinal. A partir disso, é gerada de modo automático a tabela de contingência. Ou seja, a quantidade verdadeiros positivos (VP), falsos positivos (FP), verdadeiros negativos (VN) e falsos negativos (FN), como foi discutido na seção \ref{subsec:TabelaCont} Tabela de Contingência do capítulo \ref{sec:Fund} Fundamentação Teórica. A figura \ref{avaliar} mostra ideias básicas para auxiliar a compreensão deste procedimento.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.6\textwidth]{./figs/aval2.png} % <- formatos PNG, JPG e PDF
	\caption[Exemplo de avaliação de acertos e erros de classificação]{Exemplo de avaliação de acertos e erros de classificação}
	\fonte{Autoria Própria}
	\label{avaliar}
\end{figure}

O processo de avaliação é feito conforme a seguinte lógica:

\begin{enumerate}
	\item São enviadas como parâmetro no construtor da classe Avaliador duas listas: a de lista de resultados (sistema) e a lista de marcações (referência), que enviam a posição x de cada evento em relação ao vetor de todos os pontos do sinal;
	\item As duas listas são recriadas, utilizando outras estruturas que possibilitam o uso de \textit{flags} e outras variáveis. Os itens da lista de resultados armazenam então apenas o horário de ocorrência. E os itens da lista de marcações tem seu horário transformado em um intervalo com início e fim, ao sofrerem uma expansão de tamanho variável \textit{x} para a esquerda e para a direita(no caso 50 amostras);
	\item Percorre-se a lista de marcações, verificando, se cada um dos resultados está dentro do intervalo de alguma marcação. Caso esteja, ocorreu um verdadeiro positivo (VP) e as \textit{flags} de detecção do resultado e da marcação são ativadas. Caso contrário, ou seja, se o resultado está fora da faixa de qualquer uma das marcações, caracteriza-se como falso positivo (FP);
	\item Novamente, percorre-se a lista de marcações, verificando quais marcações não foram detectadas, pois não apresentam resultado correspondente. Estas ocorrências são classificadas como falso negativo (FN), pois o sistema deveria detectá-las, mas não conseguiu;
	\item Por fim, o avaliador considera como verdadeiro negativo (VN) o intervalo entre duas marcações consecutivas (entre o fim de uma e início da seguinte) em que não ocorreu nenhum falso positivo (FP).
\end{enumerate}


\section{Modelagem UML}
\label{sec:UML}

Para proporcionar um entendimento da arquitetura do sistema, estão seção apresenta o diagrama de classes resumido na figura \ref{UML}. 

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.9\textwidth]{./figs/UML2.png} % <- formatos PNG, JPG e PDF
	\caption[Diagrama de Classes do Sistema]{Diagrama de Classes do Sistema}
	\fonte{Autoria Própria}
	\label{UML}
\end{figure}

O sistema foi desenvolvido na linguagem C\#. Na classe Program é iniciado o sistema por meio da janela FormPrincipal. Outras janelas podem ser exibidas de acordo com as interações do usuário, tais como, FormEditorDeEventos, FormEditarNomePadrao, InfoEDF, FormSite e FormResultados. Há também outras classes auxiliares do sistema. Mais detalhes sobre cada uma delas estão resumidos na tabela \ref{Classes}.

\begin{table}[!htb]
	\centering
	\caption[Classes do sistema]{Classes do sistema}
	\label{Classes}
	\begin{tabular}{l|l}
	\hline
	\textbf{Avaliador}  			& Gera tabela de contingência: VP, FP, VN e FN \\ \hline
	\textbf{AV\_Marcacao} 			& Gerencia marcações da base de dados na avaliação \\ \hline
	\textbf{AV\_Resultado} 			& Gerencia resultados do sistema na avaliação \\ \hline
	\textbf{GerenArquivos} 			& Gerencia arquivos (sinal e marcações) \\ \hline
	\textbf{Correlacao} 			& Aplica função correlação no sinal \\ \hline
	\textbf{Annotations\_Chart} 	& Carrega a lista de eventos marcados ou resultados \\ \hline
	\textbf{atualiza\_sinal}    	& Carrega eventos marcados do sinal caso elas já existam \\ \hline
	\textbf{AtualizarRefInChart}	& Atualiza o ponto de referência de um evento \\ \hline	
	\textbf{Program}  				& Classe que inicializa o sistema \\ \hline	
	\textbf{Licenca}            	& Gerencia licença do sistema \\ \hline
	\textbf{Form\_Site}         	& Carrega e exibe o website do projeto\\ \hline
	\textbf{FormCarregar\_EDF}  	& Janela para selecionar arquivo contendo o sinal \\ \hline
	\textbf{FormEditarNomePadrao}   & Janela de edição do nome do padrão \\ \hline
	\textbf{FormEditorDeEventos}    & Janela de editor de eventos\\ \hline
	\textbf{FormPrincipal}       	& Janela principal do sistema, onde é exibido o sinal \\ 
									& e realizada as marcações \\ \hline
	\textbf{FormResultados}  		& Janela onde é mostrado canal por canal e a saída da correlação\\ 
									& e as redes neurais quando executadas\\ \hline
	\textbf{InfoEDF}           		& Exibe informações sobre o EDF, como nome do paciente, data\\ \hline
	\textbf{MDIPrincipalForm}       & Tela inicial, onde pode-se abrir várias telas do FormPrincipal\\ \hline
	\textbf{RedesNeurais}           & Realiza o reconhecimento de padrões \\ \hline
	\end{tabular}
	\fonte{Autoria Própria}
\end{table}

\section{Metodologia de Testes}
\label{sec:Met-Testes}
Esta seção apresenta a metodologia utilizada na etapa de testes. É composta por apenas uma seção: Geração dos Dados de Treinamento.

\subsection{Geração dos Dados de Treinamento}
\label{sec:geradados}

Para determinar se de fato ocorre um complexo QRS no sinal, foram tomadas como referência as marcações de complexo QRS provenientes da base de dados \textit{MIT-BIH Arrhythmia Database}. O arquivo de texto contendo as marcações do sinal de Eletrocardiografia (ECG) 105, apresenta 2691 eventos. Destes 2691 eventos, apenas 2572 são relevantes para os testes neste projeto, que correspondem às marcações  de \textit{Normal beat} (2526 ocorrências), \textit{Premature ventricular contraction} (41 ocorrências) e \textit{Unclassifiable beat} (5 ocorrências).

Logo, o sinal inteiro apresenta 2572 ocorrências do complexo QRS. No entanto, apenas os 14 minutos inicias da gravação são utilizados. O que corresponde a 306900 amostras, e 1182 ocorrências de QRS. Este conjunto de dados inteiro funciona como dados de entrada para o mapa de Kohonen. Os dados são então agrupados, e o grupo do complexo QRS é separado dos demais, como explicado na subseção \ref{sec:Testes0} Módulo de Reconhecimento de Padrões com Mapa de Kohonen.

Para o treinamento da rede Perceptron multicamadas, podem ser usados dois conjuntos de dados. O primeiro deles é constituído de eventos marcados diretamente no sinal de ECG. Para gerar este conjunto de dados, foram marcados os complexos QRS dos dois terços iniciais do sinal, que apresentam cerca de 200 mil amostras. Foi gerado então um conjunto de dados formado por 700 marcações do complexo QRS salva em arquivo texto. Em seguida, foram devidamente ajustados os pontos de referência (no pico) para cada marcação.

O segundo conjunto de dados, foi obtido após aplicação da função correlação de um complexo QRS com o sinal inteiro (original) de ECG. Também foram utilizadas as primeiras 200 mil amostras do sinal (dois terços), gerando 700 marcações. 

A figura \ref{geradados} mostra os dois tipos de eventos marcados que podem ser utilizados para treinar a rede.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.4\textwidth]{./figs/geradados.png} % <- formatos PNG, JPG e PDF
	\caption[Dois tipos de eventos marcados]{Dois tipos de eventos marcados}
	\fonte{Autoria Própria}
	\label{geradados}
\end{figure}

\section{Considerações}
\label{sec:Cons-Des}

Ao fim deste capítulo de Materiais e Métodos, espera-se que o leitor tenha compreendido como opera o sistema de acordo com as duas metodologias descritas: utilizando sinal de Eletrocardiografia (ECG) puro ou sinal após extração de características.

O sistema foi explicado por diferentes abordagens, desde a análise dos componentes básicos como bibliotecas e formato de arquivo utilizados, até uma análise global, envolvendo diagramas de blocos, apresentação de telas do sistema e Modelagem UML.

O próximo capítulo, \ref{sec:Resultados} Resultados Obtidos, pretende explorar o desempenho do sistema, conforme a metodologia de avaliação apresentada neste capítulo, na seção \ref{Mod5} Módulo de Avaliação de Desempenho das Redes Neurais.

% -------------------------------------------
\chapter{Resultados Obtidos} % 3 a 4 páginas
\label{sec:Resultados}

Conforme foi apresentado na subseção \ref{Vgeral} Visão Geral da seção \ref{sec:MOD} Sistema, o reconhecimento de padrões pode ser realizado de três maneiras distintas. A primeira delas utiliza o Mapa de Kohonen, as outras duas utilizam redes neuras artificiais multicamadas. As redes multicamadas são treinadas com dois conjuntos de dados diferentes: marcações feitas diretamente no sinal de Eletrocardiografia (ECG), e marcações feitas no sinal resultante do processo de extração de características. Os resultados obtidos com cada tipo de reconhecimento são descritos nas seções \ref{sec:Testes0} Resultados com Mapa de Kohonen e \ref{sec:Testes1} Resultados com Rede Multicamadas, respectivamente. Este capítulo finaliza com a seção \ref{sec:TestesConsider} Considerações.

\section{Resultados com Mapa de Kohonen}
\label{sec:Testes0}

Os testes realizados utilizando Mapa de Kohonen para reconhecimento de padrões obtiveram os resultados apresentados na tabela \ref{tab:kohonen}. De acordo com as marcações provenientes da base de dados, há 1182 ocorrências do complexo QRS 
no fragmento do sinal analisado. Como visto anteriormente, eventos do tipo complexo QRS se concentraram nas regiões do mapa em que a coordenada \textit{x} tem o valor 0 e a coordenada \textit{y} varia de 0 a 2. O coeficiente de aprendizado foi configurado com o valor 0,0001.

\begin{table}[!htb]
	\centering
	\caption[Resultados Obtidos com Mapa de Kohonen]{Resultados Obtidos com Mapa de Kohonen}
	\label{tab:kohonen}
		    \begin{tabular}{cccccccc}
		    \hline
		    VP & VN & FP & FN & Sensibilidade & Especificidade & Eficiência & DER \\ \hline
		    \hline
		    1177  & 1180  & 1  & 5  & 0,9957 & 0,9991& 0,9974& 0,0023 \\ \hline
		    \end{tabular}
		    \fonte{Autoria Própria}
\end{table}

\section{Resultados com Rede Perceptron Multicamadas}
\label{sec:Testes1}

A tabela \ref{tab:rawECG1} mostra os resultados obtidos com uma rede MLP treinada com eventos marcados diretamente no sinal de ECG. Os dados analisados correspondem aos 14 primeiros minutos do sinal do arquivo 105, o que equivale a 1182 ocorrências do complexo QRS. Na tabela são apresentados os totais de verdadeiros positivos, verdadeiros negativos, falsos positivos e falsos negativos obtidos pela etapa de reconhecimento de padrões. E também os índices estatísticos sensibilidade, especificidade, eficiência e \textit{Detection Error Rate} (DER) considerando a variação do \textit{threshold}.

\begin{table}[!htb]
	\centering
	\caption[Resultados com marcações no ECG]{Resultados com marcações no ECG}
	\label{tab:rawECG1}
		    \begin{tabular}{ccccccccc}
		    \hline
		    \textit{Threshold} & VP & VN & FP & FN & Sensibilidade & Especificidade & Eficiência & DER \\ \hline
		    \hline
		    1     & 1171  & 1181 & 0  	& 11 	& 0,9906	& 1 	   & 0,9953	& 0,0042  \\ 
		    0,9   & 1173  & 1181 & 0  	& 9  	& 0,9923	& 1        & 0,9961	& 0,0034  \\ 
		    0,8   & 1175  & 1181 & 0  	& 7  	& 0,9940 	& 1        & 0,9970	& 0,0027  \\ 
		    0,7   & 1176  & 1181 & 0  	& 6  	& 0,9949	& 1        & 0,9974	& 0,0023  \\ 
		    0,6   & 1176  & 1180 & 1  	& 6  	& 0,9949	& 0,9991   & 0,9970	& 0,0027  \\ 
		    0,5   & 1176  & 1180 & 1  	& 6  	& 0,9949	& 0,9991   & 0,9970	& 0,0027  \\
		    0,4   & 1176  & 1180 & 1  	& 6  	& 0,9949	& 0,9991   & 0,9970	& 0,0027  \\
		    0,3   & 1177  & 1179 & 2  	& 5  	& 0,9957	& 0,9983   & 0,9970	& 0,0027  \\
		    0,2   & 1177  & 1179 & 3  	& 5  	& 0,9957	& 0,9983   & 0,9970	& 0,0027  \\
		    0,1   & 1177  & 1179 & 3  	& 5  	& 0,9957	& 0,9983   & 0,9970	& 0,0027  \\ \hline
		    \end{tabular}
		    \fonte{Autoria Própria}
\end{table}

A curva ROC do processo utilizando eventos marcados diretamente no sinal de ECG é mostrada na figura ~\ref{ROC1}.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.5\textwidth]{./figs/rocecg1.png} % <- formatos PNG, JPG e PDF
	\caption[Curva ROC dos resultados da rede Perceptron multicamadas]{Curva ROC dos resultados da rede Perceptron multicamadas}
	\fonte{Autoria própria}
	\label{ROC1}
\end{figure}

A tabela \ref{tab:rawECG2} mostra os resultados obtidos com a base de eventos gerada após o processo de extração de características (correlação). Do mesmo modo que a seção anterior, o conjunto de testes considera os primeiros 14 minutos do sinal de ECG do arquivo 105, correspondendo a 1182 ocorrências do complexo QRS. São apresentadas as quantidades de verdadeiros positivos, verdadeiros negativos, falsos positivos e falsos negativos, e os índices estatísticos sensibilidade, especificidade, eficiência e \textit{Detection Error Rate} (DER) obtidos com variação do \textit{threshold}.

\begin{table}[!htb]
	\centering
	\caption[Tabela de Resultados após correlação]{Tabela de Resultados após correlação}
	\label{tab:rawECG2}
		    \begin{tabular}{ccccccccc}
		    \hline
			\textit{Threshold} & VP & VN & FP & FN & Sensibilidade & Especificidade & Eficiência & DER \\ \hline
		    \hline
		    1         & 1143 & 1095 & 86 & 39  & 0,9670 & 0,9271 & 0,9471 & 0,0486\\ 
		    0,9       & 1143 & 1093 & 88 & 39  & 0,9670 & 0,9254 & 0,9462 & 0,0493\\ 
		    0,8       & 1144 & 1089 & 92 & 38  & 0,9678 & 0,9220 & 0,9449 & 0,0505\\ 
		    0,7       & 1144 & 1089 & 92 & 38  & 0,9678 & 0,9220 & 0,9449 & 0,0505\\ 
		    0,6       & 1144 & 1084 & 97 & 38  & 0,9678 & 0,9220 & 0,9428 & 0,0524\\ 
		    0,5       & 1144 & 1084 & 97 & 38  & 0,9678 & 0,9220 & 0,9428 & 0,0524\\ 
		    0,4       & 1145 & 1083 & 98 & 37  & 0,9686 & 0,9170 & 0,9428 & 0,0524\\ 
		    0,3       & 1145 & 1082 & 99 & 37  & 0,9686 & 0,9161 & 0,9424 & 0,0528\\ 
		    0,2       & 1145 & 1081 & 100 & 37 & 0,9686 & 0,9153 & 0,9420 & 0,0532\\ 
		    0,1       & 1145 & 1081 & 100 & 37 & 0,9686 & 0,9153 & 0,9420 & 0,0532\\ \hline
		    \end{tabular}
		    \fonte{Autoria Própria}
\end{table}

A curva ROC do processo utilizando a base gerada após a extração de características é mostrada na figura ~\ref{ROC2}.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.5\textwidth]{./figs/rocecg2.png} % <- formatos PNG, JPG e PDF
	\caption[Curva ROC dos resultados da rede Perceptron multicamadas com correlação]{Curva ROC dos resultados da rede Perceptron multicamadas com correlação}
	\fonte{Autoria própria}
	\label{ROC2}
\end{figure}

\section{Comparativo de Desempenho das Redes}
\label{sec:Comparativo}

A figura \ref{ROC3} mostra um detalhe da curva ROC com a sobreposição do desempenho das três técnicas avaliadas, permitindo uma comparação de desempenho entre os algoritmos, visto que foi utilizado o mesmo conjunto de sinais. Percebe-se que a técnica com melhor desempenho é o Mapa de Kohonen, pois o ponto que o representa é o que mais se aproxima do ponto em que a sensibilidade e a especificidade são iguais a um (sistema classificador ideal). A rede MLP com sinal de ECG apresentou resultados comparáveis ao Mapa de Kohonen. E a rede MLP com extração de características via correlação apresentou um desempenho muito inferior, comparado com as outras duas implementações.


\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.7\textwidth]{./figs/comparar.png} % <- formatos PNG, JPG e PDF
	\caption[Detalhe da curva ROC com a sobreposição dos desempenhos dos algoritmos avaliados]{Detalhe da curva ROC com a sobreposição dos desempenhos dos algoritmos avaliados}
	\fonte{Autoria própria}
	\label{ROC3}
\end{figure}


\section{Considerações}
\label{sec:TestesConsider}

Com base nos testes realizados, os três métodos de reconhecimento de padrões implementados podem ser considerados sistemas classificadores. A forma do gráfico da curva ROC da rede Perceptron multicamadas, com ambas as bases de eventos, caracteriza o sistema como classificador, como foi explicado na subseção \ref{subsec:ROCCurva} Curva ROC. 

O mesmo pode se afirmar por meio da observação dos dados estatísticos. Os valores da sensibilidade variaram entre 0,9670 (rede Perceptron multicamadas treinada com extração de características e \textit{threshold} 0,1) e 0,9957 (Mapa de Kohonen). Já os valores mínimo e máximo da especificidade variaram entre 0,9153 (rede Perceptron multicamadas treinada com extração de características e \textit{threshold} 0,1) e 1 (rede Perceptron multicamadas treinada com eventos marcados diretamente no sinal). E a eficiência apresentou como valor máximo 0,9974 (Mapa de Kohonen) e valor mínimo 0,9420 (rede Perceptron multicamadas treinada com extração de características e \textit{threshold} 0,1).

Os resultados obtidos com a utilização do Mapa de Kohonen superaram em muito qualquer expectativa, dada a facilidade de sua implementação e o fato de realizar aprendizado não supervisionado. Em relação a rede Perceptron multicamadas, o Mapa de Kohonen mostrou melhor desempenho, ao menos para o fragmento do sinal testado. Nas poucas partes em que o sinal apresentou muito ruído, a rede Perceptron multicamadas foi mais eficiente.

Na tabela \ref{tab:correlacao}, podem ser observados resultados obtidos a partir da aplicação de diferentes métodos na mesma base de dados utilizada neste trabalho. E possibilita a comparação dos valores observados do índice \textit{Detection Error Rate} (DER) entre eles.

\begin{table}[!htb]
	\centering
		\caption[Comparação de Métodos]{Comparação dos métodos utilizados para detecção do QRS oriunda da tabela de \cite{Zhang2007} acrescido das quatro últimas linhas com resultados obtidos no trabalho de \cite{SARAIVA2012}}
	\label{tab:correlacao}
	\begin{tabular}{llllll}
		\hline 
		Método & QRS & FP & FN & DER \\
		\hline
		\hline
		Algoritmos genéticos & 2572 & 86 & 5 & 3,54 \\
		Filtro passa banda & 2572 & 67 & 22 & 3,46 \\
		Wavelet denoising & 2572 & 78 & 5 & 3,23 \\
		Bancos de filtragem & 2139 & 53 & 16 & 3,22 \\
		BPF/search-back & 2564 & 53 & 22 & 2,95 \\
		Filtro adaptativo linear & 2572 & 40 & 22 & 2,40 \\
		Filtragem otimizada & 2572 & 35 & 21 & 2,18 \\
		Topological mapping & 2572 & 41 & 4 & 1,75\\
		Transformada wavelet & 2572 & 15 & 12 & 1,09 \\
		Filtro adaptativo e rede neural & 2572 & 10 & 4 & 0,5 \\
		Morfologia 1M & 2572 & 49 & 10 & 2,29 \\
		Morfologia 2M & 2572 & 27 & 9 & 1,40 \\
		Morfologia 3M & 2572 & 19 & 7 & 1,01 \\
		Morfologia 1M & 2690 & 40 & 2 & 1,56 \\
		Morfologia 2M & 2690 & 41 & 2 & 1,60 \\
		Morfologia 3M & 2690 & 40 & 0 & 1,49 \\
		Morfologia 4M & 2690 & 39 & 0 & 1,45 \\
		\hline 
	\end{tabular}
	\fonte{Modificada de \cite{SARAIVA2012}}
\end{table}

Cabe destacar, no entanto, que os resultados apresentados na tabela \ref{tab:correlacao} são relativos ao uso do sinal inteiro, em que as marcações da base de dados acusam entre 2572 e 2690 ocorrências do complexo QRS. Enquanto este projeto realizou testes com metade do mesmo sinal, apresentando 1182 ocorrências do complexo QRS.

No entanto, o menor valor do índice \textit{Detection Error Rate} (DER) obtido pelos outros trabalhos foi 0,5 (filtro adaptativo e rede neural). E o presente trabalho teve como valor mínimo do índice DER 0,0023 (aplicação do Mapa de Kohonen), valor inferior ao obtido por qualquer dos outros trabalhos. O valor máximo do índice DER observado nos testes deste projeto foi 0,0532 (rede Perceptron multicamadas com extração de características e \textit{threshold} 0,1).

Este capítulo apresentou os resultados de avaliação de desempenho de três técnicas de redes neurais utilizadas como classificador para o reconhecimento do complexo QRS no sinal de ECG. A comparação de desempenho pode ser realizada diretamente entre as técnicas devido ao uso do mesmo conjunto de sinais. Devido ao uso de parte do arquivo 105, os resultados obtidos neste trabalho não podem ser comparados com os resultados apresentados na literatura e listados na tabela \ref{tab:correlacao}. 

O próximo capítulo apresenta os resultados da gestão do trabalho.

%-------------------------------------------------------------------------------
\chapter{Gestão do Projeto} % 1 página
\label{sec:Gestao}

O uso do banco de sinais de ECG desenvolvido pelo MIT-BIH possibilitou um série de facilidades: disponibilidade livre na internet, sem custos, não há a necessidade do projeto para o comitê de ética em pesquisa com seres humanos, acrescido da disponibilidade das marcações dos complexos QRS executadas por especialistas em cardiologia. Este banco de sinais com as marcações disponíveis na internet também economizou tempo em contactar um especialista para efetuar as marcações.

Este capítulo apresenta as seções \ref{RecHardware} Recursos de Hardware, \ref{RecSoftware} Recursos de Software, \ref{Riscos} Análise de Riscos, \ref{Cronograma} Cronograma,  \ref{Horas} Horas de Trabalho e \ref{GPConc} Considerações.

\section{Recursos de Hardware}
\label{RecHardware}
Os recursos de \textit{Hardware} correspondem às duas máquinas utilizadas pelos membros da equipe durante o desenvolvimento do projeto: \textit{Macbook Pro} 13 polegadas, início de 2011, com processador Intel Core i7 de 2.7 GHz, memória de 16 GB e HD com 1TB e um \textit{notebook} Dell Inspiron 14R-3440 com processador Intel Core i5, memória RAM de 6GB e HD com 1TB.

\section{Recursos de Software}
\label{RecSoftware}

Os recursos de \textit{Software} utilizados neste projeto correspondem ao seguintes itens:

\begin{itemize}
	\item \textit{Visual Studio} 2012;
    \item Plataforma \textit{Microsoft} .NET versão 4.5;
	\item Biblioteca \textit{NeuroLoopGain};
	\item Biblioteca \textit{BrainNet Library}.
\end{itemize}

Para obter gratuitamente a licença do ambiente de desevolvimento \textit{Visual Studio}, a equipe se associou ao programa \text{DreamSpark}, da Universidade Tecnológica Federal do Paraná. Os demais recursos utilizados são gratuitos.

\section{Análise de Riscos}
\label{Riscos}

No início do projeto, durante a disciplina e Trabalho de Conclusão de Curso 1, a equipe elaborou uma análise de riscos, de modo a avaliar qualquer risco que pudesse vir a ocorrer. O impacto e a probabilidade de cada risco foram classificados como: baixo (1), médio/baixo (2), médio (3), médio/alto (4) ou alto (5). A tabela \ref{tab:riscos} mostra o impacto, probabilidade, e a ocorrência de cada risco.

\begin{table}[!htb]
	\centering
	\caption[Análise de Riscos]{Análise de Riscos}
	\label{tab:riscos}
		    \begin{tabular}{l|c|c|c}
		    \hline
			Risco 										& Impacto  		 & Probabilidade   & Ocorreu \\ \hline
		    \hline
		    Desistência ou incapacitação de um   		& alto (5) 		 & média/baixa (2) & Não  \\ 
		    dos membros da equipe						&          		 &	               &	  \\ \hline
		    
		    Falha de comunicação e integração  			& médio/alto (4) & média (3)	   & Não  \\ 
		    entre a equipe 								&          		 &	               &	  \\ \hline
		    
		    Escolha da técnica inadequada de     		& alto (5) 		 & média (3)	   & Não  \\ 
		    reconhecimento de padrão para sinais 		&      			 &	  			   &	  \\ \hline
		    
		    Utilização de tecnologias não eficientes    & médio/baixo (2)& baixa (1) 	   & Não  \\ 
		    para o propósito esperado                   &	   			 &	  			   &      \\ \hline
		    
		    Modificação no escopo do projeto 			& médio (3)		 & média/baixa (2) & Sim  \\ \hline
		    
		    Análise do sistema realizada de modo 		& médio/alto (4) & média/baixa (2) & Não  \\ 
		    inadequado									&	   			 &	  			   &      \\ \hline
		    
		    Resultado final com baixo desempenho 		& alto (5) 		 & média/baixa (2) & Não  \\ \hline
		    
		    Tempo de processamento muito elevado 		& médio (3)		 & baixa (1)	   & Não  \\ 
		    para a etapa de reconhecimento de 			&	   			 &	  			   &	  \\
		    padrões dos sinais							&	   			 &	  			   &	  \\
		    
		    \hline
		    \end{tabular}
		    \fonte{Autoria Própria}
\end{table}

Dentre todos os riscos avaliados e contingenciados, apenas um deles de fato ocorreu: a modificação no escopo do projeto. O escopo do projeto precisou ser modificado, adaptando o sistema a uma base de dados de sinais de Eletrocardiografia (ECG), no lugar da base de sinais eletroencefalográficos inicialmente planejada.

\section{Cronograma}
\label{Cronograma}

A figura \ref{crono} mostra o cronograma planejado pela equipe na disciplina de Trabalho de Conclusão de Curso 1. Como se pode perceber houve um atraso de quase um ano na conclusão pretendida do projeto.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.9\textwidth]{./figs/crono.png} % <- formatos PNG, JPG e PDF
	\caption[Cronograma Planejado em Trabalho de Conclusão de Curso 1]{Cronograma Planejado em Trabalho de Conclusão de Curso 1}
	\fonte{Autoria própria}
	\label{crono}
\end{figure}

\section{Horas de Trabalho}
\label{Horas}

A tabela ~\ref{tab:gestao} mostra de modo resumido as tarefas envolvidas no projeto, e as respectivas quantidades de horas planejadas e efetivamente executadas.

\begin{table}[!htb]
	\centering
	\caption[Tabela com a lista de tarefas e horas de trabalho]{Tabela com a lista de tarefas e horas de trabalho}
	\label{tab:gestao}
	\begin{tabular}{lcc}
		\hline 
		Tarefas & Horas planejadas & Horas executadas \\
		\hline
		\hline
		Plano de Projeto & 90 & 100 \\
		Pesquisa da base de dados & 0 & 30 \\
		Estudo da base de dados & 0 & 10 \\
		Ajustes na base de dados & 0 & 10 \\
		Estudo de tecnologias & 20 & 30 \\
		Módulo de visualização do sinal & 40 & 45 \\
		Módulo de marcação de eventos & 50 & 100\\
		Módulo de extração de características & 50 & 20 \\
		Módulo de reconhecimento de padrões & 50 & 100\\
		Módulo de avaliação & 50 & 40 \\
		Testes & 30 & 50 \\
		Elaboração do relatório & 50 & 70 \\
		Reuniões & 30 & 60 \\
		\hline 
		Total & 460 & 655 \\
		\hline 
	\end{tabular}
	\fonte{Autoria Própria}
\end{table}

A figura ~\ref{horas} mostra o comparativo entre as horas esperadas e as horas realmente dedicadas ao projeto.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.8\textwidth]{./figs/horas.png} % <- formatos PNG, JPG e PDF
	\caption[Quantidade de Horas Trabalhadas]{Quantidade de Horas Trabalhadas}
	\fonte{Autoria própria}
	\label{horas}
\end{figure}

\section{Considerações}
\label{GPConc}

Este capítulo apresentou os recursos de hardware e de software que foram utilizados no projeto. Foram apresentadas também as principais análises de gestão de projetos, destacando-se a análise de riscos, o cronograma e a quantidade de horas de trabalho envolvida no trabalho.

%---------------------------------------------------------------

\chapter{Considerações Finais} % 1 página
\label{sec:CFinais}

Os objetivos inicialmente definidos foram alcançados plenamente. O projeto concluiu o desenvolvimento de um sistema computacional, capaz de visualizar sinais de ECG armazenados em arquivos digitais, apresentando ainda as funcionalidades de marcar e salvar eventos do sinal, e reconhecer padrões.  Além disso, foi implementada uma técnica a mais do que inicialmente planejado. Ao todo, o sistema apresenta três técnicas diferentes para o reconhecimento de padrões: mapa de Kohonen, rede Perceptron multicamadas treinada com eventos marcados diretamente no sinal e rede Perceptron multicamadas treinada com eventos obtidos após a extração de características por meio da correlação.

Cada uma das técnicas de reconhecimento de padrões implementada foi testada com o mesmo arquivo de sinal. A rede neural mapa de Kohonen apresentou os valores 0,9957, 0,9991 e 0,9974 para sensibilidade, especificidade e eficiência.

A rede neural Perceptron multicamadas na topologia 50:8:1 foi testada com o \textit{threshold} (limiar de decisão) variando de 0,1 a 1, e os valores máximos alcançados para sensibilidade, especificidade e eficiência foram 0,9957, 1 e 0,9970. Os valores mínimos de sensibilidade, especificidade e eficiência foram 0,9906, 0,9983 e 0,9953. Nos testes com a rede Perceptron multicamadas com extração de características, a sensibilidade variou de 0,9670 (valor mínimo) a 0,9686 (valor máximo). A especificidade variou de 0,9153 a 0,9271, e a eficiência de 0,9420 a 0,9471.

Todas as técnicas apresentaram valores acima de 0,91 para os índices estatísticos de especificidade, sensibilidade e eficiência. Os valores mínimos da sensibilidade e da especificidade, considerando todas as técnicas, foram 0,9670 (rede Perceptron multicamadas treinada com extração de características e \textit{threshold} 0,1) e 0,9153 (rede Perceptron multicamadas treinada com extração de características e \textit{threshold} 0,1), respectivamente. A eficiência apresentou o valor mínimo 0,9420 (rede Perceptron multicamadas treinada com extração de características e \textit{threshold} 0,1).

Neste trabalho acadêmico, foi utilizado parte dos sinais normalmente utilizados como \textit{benchmark} de algoritmos de reconhecimento de padrões. Foram utilizados os primeiros 14 minutos de sinal de um arquivo de 30 minutos. Os valores de desempenho alcançados com estas técnicas devem-se as épocas de sinais utilizadas. A justificativa para obter resultados de desempenho superiores ao apresentado pela literatura é justamente o uso de parte do arquivo de sinais.

Em relação a utilização da base de dados obtida com extração de características, esperava-se que os testes apresentassem melhores resultados. Todavia, o Mapa de Kohonen mostrou-se extremamente eficiente como sistema classificador.

O desenvolvimento deste trabalho dispendeu 655 horas, que foram dedicadas tanto ao estudo da fundamentação teórica, quanto ao desenvolvimento do projeto propriamente dito. A principal dificuldade encontrada foi devido à necessidade de modificação do escopo do projeto.

Esta questão relativa à adoção de uma nova base de dados e adequação do sistema atrasou o desenvolvimento do projeto em torno de três meses. Contudo, após a tomada de decisão que levou a esta reestruturação, os módulos de reconhecimento de padrões e de avaliação do sistema, a etapa de testes e o relatório puderam ser concluídos durante os meses de julho, agosto e setembro de 2013.

Como trabalhos futuros, propõe-se o uso de outras bases de dados contendo outros tipos de sinal, como sinais de Eletroencefalografia (EEG), por exemplo. Seria interessante observar o comportamento dos métodos de reconhecimento implementados atuando sobre outros tipos de dados, com formas de onda menos definidas.


%------------------ Referencias --------------------
\bibliography{reflatex} % geracao automatica das referencias a partir do arquivo reflatex.bib

\end{document}
