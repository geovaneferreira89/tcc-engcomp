%% Exemplo de utilizacao do estilo de formatacao abnt-UTFPR.cls para LaTeX (v1.2)
%% Autores: Hugo Vieira Neto (hvieir@utfpr.edu.br)
%%          Diogo Rosa Kuiaski (diogo.kuiaski@gmail.com)

\documentclass{abnt-UTFPR} % estilo de documento abnTeX
\usepackage[alf,abnt-emphasize=bf,bibjustif,recuo=0cm]{abntcite} % estilo de bibliografia abnTeX
\usepackage[brazil]{babel} % pacote portugues brasileiro
\usepackage[latin1]{inputenc}
\usepackage{amsmath,amsfonts,amssymb} % pacote matematico
\usepackage{graphicx} % pacote grafico
\usepackage{fixltx2e}
\usepackage{multirow} %pacote tabela
\usepackage[section,subsection,subsubsection]{extraplaceins} %pacote pra figura não sair do lugar!

%tabelas ajustáveis
\usepackage{tabulary}
%fixar tabelas no mesmo lugar
\usepackage{float}
%\restylefloat{table}


% ---------- Preambulo ----------
\instituicao{Universidade Tecnológica Federal do Paraná} % nome da instituicao
\departamento{Departamento Acadêmico de Eletrônica/Informática} % nome do departamento
\programa{Curso Superior de Engenharia de Computação} % nome do curso

\documento{Trabalho de Conclusão de Curso} % tipo de documento
\titulacao{Engenheiro} % [Técnico], [Tecn\'ologo] ou [Engenheiro]

\titulo{Sistema para Detecção de Complexo QRS em Sinais de Eletrocardiografia} % titulo do trabalho em portugues
\title{System for QRS Complex Detection in Electrocardiographical Signals } % titulo do trabalho em ingles

\autor{Georgea Danielewicz \protect\\ Geovane Vinicius Ferreira} % autor do trabalho
\cita{DANIELEWICZ, Georgea \protect e FERREIRA, Geovane Vinícius} % sobrenome (maiusculas), nome do autor do trabalho

\palavraschave{análise de sinal, reconhecimento de padrões, eletrocardiografia, complexo QRS} % palavras-chave do trabalho
\keywords{\textit{signal analysis}, \textit{pattern classification}, \textit{electrocardiography}, \textit{QRS-complex}} % palavras-chave do trabalho em ingles


\comentario{\UTFPRdocumentodata\ apresentado ao \UTFPRdepartamentodata\ como requisito parcial para obtenção do grau de \UTFPRtitulacaodata\ no \UTFPRprogramadata\ da \ABNTinstituicaodata.}

\orientador{Professor Doutor Miguel Antonio Sovierzoski} % nome do orientador do trabalho
%\orientador[Orientadora:]{Nome da Orientadora} % <- no caso de orientadora, usar esta sintaxe
%\coorientador{Nome do Co-orientador} % nome do co-orientador do trabalho, caso exista
%\coorientador[Co-orientadora:]{Nome da Co-orientadora} % <- no caso de co-orientadora, usar esta sintaxe

\local{Curitiba} % cidade
\data{2013} % ano


%---------- Inicio do Documento ----------
\begin{document}

\capa % geracao automatica da capa
\folhaderosto % geracao automatica da folha de rosto
%\termodeaprovacao % <- ainda a ser implementado corretamente

% dedicatória (opcional)
%\begin{dedicatoria}
%Texto da dedicatória.
%\end{dedicatoria}

% agradecimentos (opcional)
\begin{agradecimentos}
Nossos sinceros agradecimentos ao Professor Miguel Antonio Sovierzoski, por ter orientado este trabalho com grande dedicação, estando sempre presente. 

Agradecemos de coração a todos os nossos familiares, pois sem eles esta realização jamais teria sido possível. E também a nossos amigos e colegas, pelos incentivos e pelo apoio. 
\end{agradecimentos}

% epigrafe (opcional)
% citação, seguida de indicação de autoria e ano, relacionada com a matéria tratada no corpo do trabalho
\begin{epigrafe}
"The human heart is not unchanging (nay, changes almost out of recognition in the twinkling of an eye) \dots" ~-- C.S. Lewis

"O coração humano não é imutável (ou melhor, muda quase que irreconhecivelmente no piscar de um olho) \dots" ~-- C.S. Lewis

\end{epigrafe}

%resumo
\begin{resumo}

Os exames de ECG (Eletrocardiografia) são considerados uma ferramenta de grande auxílio no diagnóstico de problemas cardíacos. E para se avaliar adequadamente a situação de um coração, é necessário detectar corretamente o complexo QRS durante a análise do sinal de ECG, muitas vezes corrompido por ruídos \cite{Zhang2007}. Consequentemente, tornando mais difícil a rotina dos profissionais que analisam este tipo de exame. Em virtude disto, há necessidade de ferramentas que busquem otimizar esta leitura e busca pelo padrão QRS. O objetivo deste projeto é desenvolver um sistema para reconhecimento de do complexo QRS em sinais de ECG. A metodologia adotada é composta pelas etapas de projeto, desenvolvimento e testes. As etapas de desenvolvimento e testes deverão utilizar uma base de dados de exames de ECG de domínio público. A etapa de testes será realizada por pela própria equipe, por meio de um módulo do sistema específico para este fim. O sistema desenvolvido será composto por três módulos: o módulo de interface com o usuário, o módulo para reconhecimento de padrões e o módulo de avaliação de resultados. O primeiro é responsável pela visualização do sinal de ECG opções de marcação de eventos para o reconhecimento. O módulo de reconhecimento de padrões aplica a operação de correlação matemática entre o padrão escolhido e o sinal de ECG, detectando eventos no sinal e exibindo graficamente na tela. O módulo de avaliação do sistema compara os resultados obtidos e os esperados, e os classifica como verdadeiro positivo, verdadeiro negativo, falso positivo ou falso negativo. Com base nesta avaliação, são calculadas as análises de sensibilidade e especificidade, permitindo a impressão de uma Curva ROC. Os resultados do projeto consistem, portanto, no próprio sistema e sua aplicação prática, que como resultado social facilitará a rotina dos médicos.

\end{resumo}

%abstract
\begin{abstract}
Abstract text (maximum of 500 words).
\end{abstract}

% listas (opcionais, mas recomenda-se a partir de 5 elementos)
\listadefiguras % geracao automatica da lista de figuras
\listadetabelas % geracao automatica da lista de tabelas
\listadesiglas % geracao automatica da lista de siglas
%\listadesimbolos % geracao automatica da lista de simbolos

% sumario
\sumario % geracao automatica do sumario


%---------- Inicio do Texto ----------
% recomenda-se a escrita de cada capitulo em um arquivo texto separado (exemplo: intro.tex, fund.tex, exper.tex, concl.tex, etc.) e a posterior inclusao dos mesmos no mestre do documento utilizando o comando \input{}, da seguinte forma:
\input{intro.tex} 
\input{fund.tex}
%\input{exper.tex}


%Considerações: 
%1. não ultrapassar 100 páginas
%2. introdução 5%, considerações finais 5%, fundamentação, materiais e métodos e resultados obtidos 90%
%3. 2 páginas, 1 páginas, 					15,16 páginas, 	20 páginas ,		 5 páginas
% -------------------------------------------
\chapter{Materiais e Métodos} %ou Materiais e Métodos 
\label{sec:Materiais}

Este capítulo aborda os recursos e metodologias utilizadas em todo o desenvolvimento deste trabalho. O capítulo foi dividido em seções: Base de Dados \ref{sec:BD}, \textit{European Data Format} \ref{sec:EDF}, Módulos do sistema \ref{sec:MOD}, Desenvolvimento do \textit{Software} \ref{sec:DSW}, Modelagem \sigla{UML}{Unified Modeling Language} \ref{sec:UML}, Metodologia de Testes \ref{sec:Met-Testes} e por fim as Considerações sobre o capítulo \ref{sec:Cons-Des}.

\section{Base de Dados}
\label{sec:BD}

De acordo com informações disponibilizadas pela Comissão Nacional de Ética em Pesquisa ~\cite{CONEP}, ``as pesquisas envolvendo apenas dados de domínio público que não identifiquem os participantes da pesquisa, ou apenas revisão bibliográfica, sem envolvimento de seres humanos, não necessitam aprovação por parte do Sistema CEP~--\sigla{CONEP}{Comissão Nacional de Ética em Pesquisa}.'' Por esta razão, a equipe optou por utilizar a base de dados pública MIT-BIH Arrhythmia Database. 

A MIT-BIH Arrhythmia Database foi desenvolvida pelo Beth Israel Hospital de Boston em parceria com o \sigla{MIT}{Massachusetts Institute of Technology} durante uma pesquisa sobre arritmia e temas correlatos. Tem sido utilizada como um conjunto de dados padrão para testes e avaliação para sistemas detectores de arritmias e pesquisa em dinâmica cardíaca ~\cite{MOODY1990}.

Os dados correspondem à 48 gravações ECG com duração de meia hora cada uma. São apresentados dois sinais, \textit {modified limb lead II} (MLII) e \textit{lead} V1 (podendo ser ocasionalmente V2, V5 ou V4), ambos obtidos com os eletrodos colocados no peito. Esta é a configuração padrão utilizada pelo BIH Arrhythmia Laboratory. Pode-se observar maior proeminência dos complexos QRS no sinal superior ~\cite{PhysioNet}. A figura ~\ref{105} mostra parte da gravação do exame 105.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.7\textwidth]{./figs/105.png} % <- formatos PNG, JPG e PDF
	\caption[Parte da gravação 105 da base de ECG]{Parte da gravação 105 da base de dados MIT-BIH Arrhythmia Database}
	\fonte{Autoria própria}
	\label{105}
\end{figure}

Os exames foram realizados com 47 pacientes acompanhados pelo BIH Arrhythmia Laboratory entre os anos de 1975 e 1979. Vinte e três gravações foram aleatoriamente de um conjunto de 4000 exames ambulatoriais de ECG com duração de 24 horas coletadas de pacientes internos (cerca de 60\%) e pacientes ambulatoriais (cerca de 40\%) do Boston's Beth Israel Hospital. Os outros 25 exames foram selecionados do mesmo conjunto para incluir arritmias clinicamente incomuns ~\cite{MOODY1990}.

Uma equipe com dois cardiologistas realizou anotações dos batimentos em cada uma das gravações, resultando em aproximadamente 110 mil marcações. Estas foram incluídas na base de dados. A base completa tem sido disponibilizada gratuitamente pelo desde 2005 ~\cite{MOODY1990}.

Para a etapa de testes deste projeto, foi selecionado apenas o arquivo 105 por apresentar maior dificuldade na detecção do complexo QRS ~\cite{SARAIVA2012}.

O arquivo de texto contendo as anotações do sinal de ECG 105, apresenta 2691 eventos. Destes 2691 eventos, apenas 2572 são relevantes para os testes neste projeto, que correspondem às marcações  de \textit{Normal beat} (2526 ocorrências), \textit{Premature ventricular contraction} (41 ocorrências) e \textit{Unclassifiable beat} (5 ocorrências).
 
\section{European Data Format}
\label{sec:EDF}

A existência de diferentes fabricantes de equipamentos para aquisição de sinais biomédicos implica em diferentes formatos de arquivo para salvar estes dados. Para solucionar este problema, foi criado o \sigla{EDF}{European data format}, um formato padrão para armazenamento de dados polissonográficos e eletroencefalográficos amplamente aceito. O EDF é o único formato digital que se tornou aceito tanto comercialmente nos equipamentos disponíveis como em pesquisas cientifica \cite{Kemp20031755}.

Um arquivo EDF padrão consiste em um cabeçalho seguido dos dados. O cabeçalho identifica o paciente e especifica características técnicas do sinal gravado. Os dados apresentam épocas consecutivas, com duração fixa, a partir do sinal gravado. Este formato de arquivo, no entanto, não suporta anotações de eventos das gravações \cite{Kemp20031755}.

Physiobank \sigla{ATM}{Automated Teller Machine} \textit{(Automated Teller Machine)} é uma ferramenta \textit{open~--source} que permite explorar as bases de dados disponibilzadas pelo PhysioBank por meio do navegador de internet. Esta toolbox software oferece opções para importar anotações das formas de onda e histogramas, converter sinais em formato padrão do Physionet (\sigla{WFDB}{WaveForm DataBase} ~-- WaveForm DataBase) para texto, CSV, EDF, ou .mat files (para utilização em Matlab ou Octave), entre outras funcionalidades \cite{PhysioNet}.

A figura ~\ref{ATM} mostra a tela de opções da ferramenta Physiobank ATM.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=1\textwidth]{./figs/ATM.png} % <- formatos PNG, JPG e PDF
	\caption[Physiobank ATM]{Tela de opções do Physiobank ATM}
	\fonte{Autoria própria}
	\label{ATM}
\end{figure}

\section{Desenvolvimento do Software}
\label{sec:DSW}

\section{Módulos do sistema}
\label{sec:MOD} 
Eu consigo antever cinco módulos (Aí explica o que cada um faz):
Telas do sistema vão aqui.


A figura ~\ref{fluxogramaRaw} mostra o processo utilizando raw ECG.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.7\textwidth]{./figs/fluxogramaRaw.png} % <- formatos PNG, JPG e PDF
	\caption[Fluxograma]{Fluxograma}
	\fonte{Autoria própria}
	\label{fluxogramaRaw}
\end{figure}


A figura ~\ref{FluxoCorrel} mostra o processo utilizando correlação.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.9\textwidth]{./figs/FluxoCorrel.png} % <- formatos PNG, JPG e PDF
	\caption[Fluxograma da correlação]{Fluxograma da Correlação}
	\fonte{Autoria própria}
	\label{FluxoCorrel}
\end{figure}


\subsection{Visualização do sinal}
Explicar por exemplo, a duração do exame, quantos canais, a frequência e amplitude.

\subsection{Marcação de eventos}
Que tipo de eventos marcamos, em arquivo de texto, seguindo um padrão definido.

\subsection{Extração de Características}
Aqui será explicado o modo como foi utilizada a operação da Correlação.
Correlação de um evento marcado com o sinal inteiro, gerando um novo sinal... com picos onde eventos daquele tipo ocorrem.

\subsection{Reconhecimento de padrões}
No caso utilizamos a Rede Neural MultiLayer Perceptron.

\subsection{Avaliação de Resultados}
Módulo que compara marcações com os resultados obtidos.

\section{Modelagem UML}
\label{sec:UML}

Usamos algum padrão, MVC, etc....

\subsection{Bibliotecas}
Bibliotecas gráficas, biblioteca para abrir arquivo EDF.

\section{Metodologia de Testes}
\label{sec:Met-Testes}

Achei que já tínhamos explicado isso aqui na Fundamentação Teórica.
Mas se não foi o suficiente explicamos melhor aqui...
O que são os VP, VN, FP, e FN no nosso caso (complexo QRS, arritmias...). 
E o que precisou ser variado para gerar a curva ROC. Threshold
Podemos colocar umas telas, comparando o resultado obtido com a marcação que já vem com a base de dados.

\section{Considerações}
\label{sec:Cons-Des}

% -------------------------------------------
\chapter{Resultados Obtidos} % 3 a 4 páginas
\label{sec:Resultados}
Introdução do Capítulo. Um parágrafo basta. 

Blá

Blá

Blá

Blá...

Vai texto aqui

\section{Testes com Raw ECG}

Eis os resultados na tabela.

\begin{table}[!htb]
	\centering
	\caption[Tabela de Resultados Obtidos com Raw ECG]{Tabela de Resultados Obtidos com Raw ECG}
	\label{tab:rawECG}
		    \begin{tabular}{ccccccccc}
		    \hline
		    Threshold & VP & VN & FP & FN & Sensibilidade & Especificidade & Eficiência & DER \\ \hline
		    \hline
		    0         & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ 
		    0,1       & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ 
		    0,2       & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ 
		    0,3       & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ 
		    0,4       & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ 
		    0,5       & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ 
		    0,6       & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ 
		    0,7       & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ 
		    0,8       & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ 
		    0,9       & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ 
		    1         & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ \hline
		    \end{tabular}
\end{table}

A curva ROC do processo utilizando \textit{raw} ECG é mostrada na figura ~\ref{ROC1}.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.3\textwidth]{./figs/paca.png} % <- formatos PNG, JPG e PDF
	\caption[Curva ROC dos resultados]{Curva ROC dos resultados}
	\fonte{Autoria própria}
	\label{ROC1}
\end{figure}

\section{Testes com ECG com correlação}

\begin{table}[!htb]
	\centering
	\caption[Tabela de Resultados utilizando correlação]{Tabela de Resultados utilizando correlação}
	\label{tab:rawECG}
		    \begin{tabular}{ccccccccc}
		    \hline
		    Threshold & VP & VN & FP & FN & Sensibilidade & Especificidade & Eficiência & DER \\ \hline
		    \hline
		    0         & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ 
		    0,1       & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ 
		    0,2       & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ 
		    0,3       & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ 
		    0,4       & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ 
		    0,5       & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ 
		    0,6       & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ 
		    0,7       & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ 
		    0,8       & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ 
		    0,9       & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ 
		    1         & ~  & ~  & ~  & ~  & ~             & ~              & ~          & ~   \\ \hline
		    		    \end{tabular}
\end{table}

A curva ROC do processo utilizando correlação é mostrada na figura ~\ref{ROC2}.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.3\textwidth]{./figs/paca.png} % <- formatos PNG, JPG e PDF
	\caption[Curva ROC do processo com correlação]{Curva ROC do processo com correlação}
	\fonte{Autoria própria}
	\label{ROC2}
\end{figure}

\section{Comparativo dos Resultados}
Curva ROC comparativa.

\section{Considerações}
Então.. o sistema é classificador ou não? (De acordo com a curva ROC)
Compara a outros trabalhos

\begin{table}[!htb]
	\centering
	\caption[Tabela Comparativa de métodos]{Comparação dos métodos utilizados para detecção do QRS oriunda da tabela de Zhang e Lian (2009) acrescido das quatro últimas linhas com resultados obtidos no trabalho de \cite{SARAIVA2012}}
	\label{tab:correlacao}
	\begin{tabular}{llllll}
		\hline 
		Método & QRS & FP & FN & DER \\
		\hline
		\hline
		Algoritmos genéticos & 2572 & 86 & 5 & 3,54 \\
		Filtro passa banda & 2572 & 67 & 22 & 3,46 \\
		Wavelet denoising & 2572 & 78 & 5 & 3,23 \\
		Bancos de filtragem & 2139 & 53 & 16 & 3,22 \\
		BPF/search-back & 2564 & 53 & 22 & 2,95 \\
		Filtro adaptativo linear & 2572 & 40 & 22 & 2,40 \\
		Filtragem otimizada & 2572 & 35 & 21 & 2,18 \\
		Topological mapping & 2572 & 41 & 4 & 1,75\\
		Transformada wavelet & 2572 & 15 & 12 & 1,09 \\
		Filtro adaptativo e rede neural & 2572 & 10 & 4 & 0,5 \\
		Morfologia 1M & 2572 & 49 & 10 & 2,29 \\
		Morfologia 2M & 2572 & 27 & 9 & 1,40 \\
		Morfologia 3M & 2572 & 19 & 7 & 1,01 \\
		Morfologia 1M & 2690 & 40 & 2 & 1,56 \\
		Morfologia 2M & 2690 & 41 & 2 & 1,60 \\
		Morfologia 3M & 2690 & 40 & 0 & 1,49 \\
		Morfologia 4M & 2690 & 39 & 0 & 1,45 \\
		\hline 
	\end{tabular}
	\fonte{Modificada de \cite{SARAIVA2012}}
\end{table}

%----------------------------------------
\chapter{Considerações Finais} % 1 página
\label{sec:CFinais}

Alcançou os objetivos?? Quanto conseguiu atingir? A metodologia foi boa ou ruim? 

Cada seção teve a sua conclusão, então completa a discussão. Elementos resultantes do processo de união. Não apresentar nenhum dado novo! 1 folha e meia no máximo. 

Propostas futuras? Resultados futuros.

Com redes SOM, ou com outras bases de dados.

\chapter{Gestão do Projeto} % 1 página
\label{sec:Gestao}

Inicialmente, este projeto pretendia utilizar uma base de dados de exames de EEG, obtida em um Hospital, mediante autorização do Comitê de Ética da Instituição. A metodologia de testes seria realizada por um médico neurologista, que avaliaria os resultados do sistema, classificando-os como verdadeiro positivo, verdadeiro negativo, falso positivo ou falso negativo. 

Contudo, dada a limitação de tempo para a conclusão deste trabalho, e a escassez de bases de dados de EEG públicas adequadas (o que dispenderia menor tempo, por não necessitar de autorização do Comitê de Ética), a equipe alterou o escopo do projeto, passando a utilizar uma base de dados pública de ECG.

Esta mudança trouxe alguns benefícios, dentre eles a possibilidade de a própria equipe realizar os testes, uma vez que a base de dados já possui marcações dos eventos, bastando apenas compará-las aos eventos identificados pelo sistema.

\section{Recursos de Hardware}

Os recursos de \textit{Hardware} correspondem às duas máquinas utilizadas pelos membros da equipe durante o desenvolvimento do projeto: Macbook Pro 13 polegadas, início de 2011, com processador Intel Core i7 de 2.7 GHz, memória de 16 GB e HD com 1TB e um \textit{notebook} Dell Inspiron 14R-3440 com processador Intel Core i5, memória RAM de 6GB e HD com 1TB.

\section{Recursos de Software}

Linguagens de Programação

O software foi desenvolvido na linguagem C Sharp versão ?.

IDE Utilizada

O ambiente de desenvolvimento utilizado foi o Visual Studio versão X.

Para a licença deste produto a equipe participou do DreamSpark.

Bibliotecas: EDF e RN

\section{Quantidade de Horas Trabalhadas}

Gráfico com barras comparando o esperado com o real na figura ~\ref{horas}.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.8\textwidth]{./figs/horas.png} % <- formatos PNG, JPG e PDF
	\caption[Gráfico da Quantidade de Horas Trabalhadas]{Gráfico da Quantidade de Horas Trabalhadas}
	\fonte{Autoria própria}
	\label{horas}
\end{figure}

%------------------ Referencias --------------------
\bibliography{reflatex} % geracao automatica das referencias a partir do arquivo reflatex.bib

\end{document}
